<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        height: 100vh;
        width: 100vw;
        background-color: #d3d3d3;
      }
      .vid {
        height: 300px;
        width: 300px;
        object-fit: contain;
      }
      .local {
        border: #f00 solid 5px;
      }
    </style>
  </head>
  <body>
    <div id="main-container" class="container"></div>
    <script src="./mediasoup-simple-client-bundle.js"></script>
    <script>
      function addANewVideoElement(track, isLocal) {
        const newVideoElement = document.createElement("video");
        newVideoElement.muted = true;
        newVideoElement.playsInline = true;
        newVideoElement.autoplay = true;
        newVideoElement.controls = true;
        newVideoElement.srcObject = new MediaStream([track]);
        newVideoElement.classList.add("vid");
        if (isLocal) {
          newVideoElement.classList.add("local");
        }
        const container = document.getElementById("main-container");
        container.appendChild(newVideoElement);
      }

      (async () => {
        // Initializing connection to the server.
        let roomClient = new mediasoup.RoomClient({
          roomId: "p6afwjkb",
          peerId: `${(Math.random() * 1000) | 0}`,
          displayName: `${(new Date().getTime() / 1000) | 0}`,
          baseUrl: "ws://localhost:4443",
          mode: mediasoup.MODES.VIDEO_ONLY,
          useSimulcast: true,
          forceH264: true,
        });
        await roomClient.join();
        // Listen for events on 'PRODUCER's. Local tracks.
        roomClient.on(mediasoup.EVENTS.PRODUCER.NEW_PRODUCER, (producer) => {
          const track = producer.track;
          // Producers are local tracks
          addANewVideoElement(track, true);
        });
        // Listen for events on 'CONSUMERS's. Local tracks.
        roomClient.on(mediasoup.EVENTS.CONSUMER.NEW_CONSUMER, (consumer) => {
          const track = consumer.consumer.track;
          // Consumers are remote tracks
          addANewVideoElement(track, false);
        });
        // Print all supported events
        console.log("Here's a list of mediasoup events supported.");
        console.log(mediasoup.EVENTS);
        //Subscribing to all events
        const eventGroups = Object.keys(mediasoup.EVENTS);
        for (const group of eventGroups) {
          let events = Object.keys(mediasoup.EVENTS[group]);
          for (const ev of events) {
            roomClient.on(ev, (data) => {
              console.log(`${group} Event: ${ev}`, data);
            });
          }
        }

        window.roomClient = roomClient;
      })();
    </script>
  </body>
</html>
